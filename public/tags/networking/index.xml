<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Networking on Mischa van den Burg</title>
    <link>https://mischavandenburg.com/tags/networking/</link>
    <description>Recent content in Networking on Mischa van den Burg</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <lastBuildDate>Sat, 13 Jan 2024 00:00:00 +0000</lastBuildDate><atom:link href="https://mischavandenburg.com/tags/networking/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Designed The Network For My Homelab</title>
      <link>https://mischavandenburg.com/zet/homelab-network-design/</link>
      <pubDate>Sat, 13 Jan 2024 00:00:00 +0000</pubDate>
      
      <guid>https://mischavandenburg.com/zet/homelab-network-design/</guid>
      <description>My ISP router only allowed me to assign 200 IP addresses and it didn&amp;rsquo;t have any possibility to create VLANS, so it was time for an upgrade to my setup.
Now that I&amp;rsquo;m hosting several clusters in my homelab and exposing things to the internet I can justify to spend the money on this hardware and the complexity of dividing up my home network into VLANS.
I bought a Unifi Express gateway and the Unifi Lite 8 PoE managed switch.</description>
      <content:encoded><![CDATA[<p>My ISP router only allowed me to assign 200 IP addresses and it didn&rsquo;t have any possibility to create VLANS, so it was time for an upgrade to my setup.</p>
<p>Now that I&rsquo;m hosting several clusters in my homelab and exposing things to the internet I can justify to spend the money on this hardware and the complexity of dividing up my home network into VLANS.</p>
<p>I bought a Unifi Express gateway and the Unifi Lite 8 PoE managed switch.</p>
<p>The gateway will function as the main portal to the internet and the WiFi access point. The switch will be located in my pantry where all the devices for my homelab are currently.</p>
<p><img loading="lazy" src="/homelab-network.png" type="" alt=""  /></p>
<h1 id="naming-strategy">Naming Strategy</h1>
<p>I&rsquo;m also going to have some fun with the naming strategy. I love Nordic mythology so I picked that as a theme.</p>
<h2 id="network-name">Network Name:</h2>
<ul>
<li><strong>AsgardNet</strong>: A reference to the home of the gods in Norse mythology, symbolizing a powerful and central network.</li>
</ul>
<h3 id="vlan-naming-strategy">VLAN Naming Strategy:</h3>
<ol>
<li><strong>Production Kubernetes Cluster</strong>: <code>Valhalla</code> - Named after the majestic hall where heroes reside, representing the strength and importance of the production environment.</li>
<li><strong>Staging Kubernetes Cluster</strong>: <code>Midgard</code> - Midgard, the world of humans in Norse mythology, can symbolize a testing ground that&rsquo;s closer to the &lsquo;real world&rsquo; scenarios.</li>
<li><strong>Main VLAN (Work &amp; Personal Devices)</strong>: <code>Yggdrasil</code> - Named after the great tree that connects all the worlds, symbolizing the connectivity and central role of this VLAN in the network.</li>
<li><strong>IoT VLAN</strong>: <code>Niflheim</code> - The realm of fog and mist, a metaphor for the mysterious and ubiquitous nature of IoT devices.</li>
<li><strong>Guest Network VLAN</strong>: <code>Folkvangr</code> - Folkvangr, where the goddess Freya hosts half of those who die in battle, signifying a place for visitors.</li>
</ol>
<h2 id="links">Links:</h2>
<p>202401130601</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>Video notes - Application Gateway for Containers</title>
      <link>https://mischavandenburg.com/zet/application-gateway-for-containers/</link>
      <pubDate>Fri, 05 Jan 2024 00:00:00 +0000</pubDate>
      
      <guid>https://mischavandenburg.com/zet/application-gateway-for-containers/</guid>
      <description>App Gateway It has App Gateway in the name, but it is an entirely new solution. The App Gateway is the only thing it has in common with Azure Application Gateway.
Resources Two types of resources. Azure resources and k8s resources.
The App Gateway for Container is an azure resource which listens to changes in k8s resources through the ALB controller. AGWFC is the control plane.
Frontend Azure Frontend is a public IP and fqdn.</description>
      <content:encoded><![CDATA[
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/slCjHV8z9Wk" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<h1 id="app-gateway">App Gateway</h1>
<p>It has App Gateway in the name, but it is an entirely new solution. The App Gateway is the only thing it has in common with Azure Application Gateway.</p>
<h1 id="resources">Resources</h1>
<p>Two types of resources. Azure resources and k8s resources.</p>
<p>The App Gateway for Container is an azure resource which listens to changes in k8s resources through the ALB controller. AGWFC is the control plane.</p>
<h1 id="frontend">Frontend</h1>
<h2 id="azure">Azure</h2>
<p>Frontend is a public IP and fqdn. Both are managed resources, you don&rsquo;t see them in your subscription.</p>
<p>You can have multiple frontends in one gateway to save money. Teams could share the app gateway but use different frontend IP addresses or FQDNs.</p>
<p>Control plane: Azure App Gateway for Containers</p>
<p>Data plane: association with kubernetes pods.</p>
<p>The association is made to the subnet in the Azure VNet.</p>
<p>Each association is in one subnet, and the subnet should at least have /24 or 256 addresses.</p>
<h1 id="kubernetes">Kubernetes</h1>
<p>ALB controller consists of two pods. Controller pod and a bootstrap pod.</p>
<p>Controller communicates to the Azure gateway resource. It talks directly to the App Gateway, not to the Azure Resource Manager, which is why you&rsquo;re able to have sub-second updates.</p>
<p>The bootstrap contains the CRDs etc, it does not do very much.</p>
<h2 id="creating-resources">Creating resources</h2>
<p>There is a managed option that will talk to ARM and create the resources for you. Or you can choose to deploy them yourself. It depends whether you want to control everything from Kubernetes. If you have all your Azure resources in Infrastructure as Code it probably makes more sense to create the App Gateway resources from there instead of from Kubernetes.</p>
<h1 id="association">Association</h1>
<p>Links frontend with a subnet in a VNet. This will typically be the same vnet that the AKS cluster is in. Could technically be a peered VNet but probably uncommon.</p>
<p>This is an Azure resource. It lives in the VNet and handles TLS and makes the connections to and from the pods and frontend IP. This is the data path.</p>
<p>The traffic is not routed within the cluster, but in Azure by the association.</p>
<p>Client talks to the front end, passes to the association, the association is doing the work, and then routing it to the cluster.</p>
<h1 id="support">Support</h1>
<p>Azure CNI. Does not support kubenet or Azure CNI overlay yet, but it will support in the future.</p>
<h1 id="kubernetes-resources">Kubernetes Resources</h1>
<p>Application Load Balancer: this name was chosen because k8s people don&rsquo;t know the concept of app gateway.</p>
<h1 id="benefits">Benefits</h1>
<ul>
<li>ssl offloading</li>
<li>traffic splitting</li>
<li>clearer separation between platform team and app team</li>
<li>platform team manages the gateway itself</li>
<li>automatic default health probes</li>
</ul>
<h1 id="benefits-of-azure">Benefits of Azure</h1>
<ul>
<li>not suing cluster resources for load balancing. this happens in azure</li>
<li>native azure metrics available</li>
</ul>
<h1 id="misc">misc</h1>
<ul>
<li>AGIC does not support ingress</li>
</ul>
<h2 id="links">Links:</h2>
<p>202309301009</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>Video: Homelab E2 - Setting Up Monitoring &#43; Studying k3s Networking  &amp; Configuring Ingress</title>
      <link>https://mischavandenburg.com/zet/video-homelab-3-k3s-networking/</link>
      <pubDate>Thu, 04 Jan 2024 00:00:00 +0000</pubDate>
      
      <guid>https://mischavandenburg.com/zet/video-homelab-3-k3s-networking/</guid>
      <description>In this video I installed Prometheus and Grafana using helm and studied k3s networking.
My goal was to make Grafana approachable via ingress using a fake domain and after a bit of tinkering it worked.
installed prometheus and grafana with kube-prometheus-stack helm chart reflected on why I use k3s gained understanding of k3s loadbalancing solution configured /etc/hosts file to resolve to fake domain configured k3s ingress to use fake local domain struggled with ingress but figured it out in the end successfully made grafana UI available on fake local domain grafana.</description>
      <content:encoded><![CDATA[
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/JjIB65CVXAo" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<p>In this video I installed Prometheus and Grafana using helm and studied k3s networking.</p>
<p>My goal was to make Grafana approachable via ingress using a fake domain and after a bit of tinkering it worked.</p>
<ul>
<li>installed prometheus and grafana with kube-prometheus-stack helm chart</li>
<li>reflected on why I use k3s</li>
<li>gained understanding of k3s loadbalancing solution</li>
<li>configured /etc/hosts file to resolve to fake domain</li>
<li>configured k3s ingress to use fake local domain</li>
<li>struggled with ingress but figured it out in the end</li>
<li>successfully made grafana UI available on fake local domain grafana.homelab.nl</li>
</ul>
<h2 id="links">Links:</h2>
<p>202312261012</p>
<p><a href="https://youtu.be/JjIB65CVXAo">https://youtu.be/JjIB65CVXAo</a></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>Began studying for AZ-700 Designing and Implementing Microsoft Azure Networking Solutions</title>
      <link>https://mischavandenburg.com/zet/starting-az-700/</link>
      <pubDate>Thu, 28 Sep 2023 00:00:00 +0000</pubDate>
      
      <guid>https://mischavandenburg.com/zet/starting-az-700/</guid>
      <description>Before I went on holiday I formed the intention to begin studying again after I came back.
During my current gig I&amp;rsquo;m configuring a fair bit of networking, VNets, peerings, firewall rules and set up a full hub-spoke network from scratch, so I&amp;rsquo;ve had a fair bit of practical experience. Now that the experience is still fresh in the mind I figured I&amp;rsquo;d go for this certification.
Usually I only use Microsoft Learn and practice exams, but this time around I want to try out a video course.</description>
      <content:encoded><![CDATA[<p>Before I went on holiday I formed the intention to begin studying again after I came back.</p>
<p>During my current gig I&rsquo;m configuring a fair bit of networking, VNets, peerings, firewall rules and set up a full hub-spoke network from scratch, so I&rsquo;ve had a fair bit of practical experience. Now that the experience is still fresh in the mind I figured I&rsquo;d go for this certification.</p>
<p>Usually I only use Microsoft Learn and practice exams, but this time around I want to try out a video course. I purchased a year of A Cloud Guru access and so far it has been a good experience.</p>
<p>I&rsquo;ll publish my notes as I go along.</p>
<h2 id="links">Links:</h2>
<p>202309280909</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>What is Azure CNI Overlay for AKS?</title>
      <link>https://mischavandenburg.com/zet/azure-aks-cni-overlay/</link>
      <pubDate>Wed, 14 Jun 2023 00:00:00 +0000</pubDate>
      
      <guid>https://mischavandenburg.com/zet/azure-aks-cni-overlay/</guid>
      <description>CNI? CNI stands for Container Network Interface. It allows communication between pods and services.
Current Azure CNI limitations Let&amp;rsquo;s take a practical example. We have an enterprise environment where a large network is utilized, spanning multiple clouds and on-prem infrastructure hubs. To enable seamless communication across these sections, they must belong to the same network. As a result, specific IP address ranges are assigned to each section, with AWS, On-Prem A, and Azure each having their respective ranges.</description>
      <content:encoded><![CDATA[<h1 id="cni">CNI?</h1>
<p>CNI stands for Container Network Interface. It allows communication between pods and services.</p>
<h2 id="current-azure-cni-limitations">Current Azure CNI limitations</h2>
<p>Let&rsquo;s take a practical example. We have an enterprise environment where a large network is utilized, spanning multiple clouds and on-prem infrastructure hubs. To enable seamless communication across these sections, they must belong to the same network. As a result, specific IP address ranges are assigned to each section, with AWS, On-Prem A, and Azure each having their respective ranges.</p>
<p>Let&rsquo;s say Azure is assigned the following ranges:</p>
<p>10.60.0.0/16</p>
<p>10.61.0.0/16</p>
<p>10.62.0.0/16</p>
<p>This means that the networks in each of these ranges would have a maximum possible amount of 65534 addresses per range.</p>
<p>With the current Azure CNI (i.e. the non-overlay version), all pods are assigned an IP address from one of these ranges. It also uses direct VNet routing.  Since the pods use VNet IP&rsquo;s, there is a maximum of 65.000 pods per cluster. In other words, there is a risk for IP exhaustion, which limits the scalability of your workloads. Moreover, pod subnets cannot be shared across clusters.</p>
<p>It is crucial to carefully plan the number of pods you expect to deploy. If the required number of IP addresses exceeds the available addresses in the subnet, you will not be able to run your pods.</p>
<p>Now, these ranges are large and you can anticipate the growth of your resources. For now we are fine. But to design an infrastructure which is truly scalable and extendable, you will need to look into different options. This is where the Azure CNI Overlay comes in.</p>
<h2 id="benefits-of-azure-cni-overlay">Benefits of Azure CNI Overlay</h2>
<p>An Overlay network is an abstracted, virtual network which is put on top of your current network infrastructure. Nodes are assigned IP addresses from the VNets that they are deployed in, but pods get assigned IP addresses from the Overlay network.</p>
<p>Pods are assigned addresses from a private CIDR which is logically separate from the VNet hosting the nodes. They do not use up the IP addressess of the VNets, which means that your workloads become nearly infinitely scalable within your assigned IP address ranges when you are operating in this type of corporate networking infrastructure with IP range limitations. You can scale up to literally thousands of nodes without worrying about IP exhaustion.</p>
<p><img loading="lazy" src="/cnioverlay.png" type="" alt=""  /></p>
<p>Additionally, the Overlay network can also span across multiple AKS clusters. This opens up a whole world of possibilities where pods from separate workloads on separate clusters could communicate with each other directly using the high speed native direct routing of the Azure network.</p>
<h2 id="limitations">Limitations</h2>
<p>Azure CNI Overlay also comes with some limitations. A big one is that you cannot use Application Gateway as an Ingress Controller (AGIC) for an Overlay cluster.</p>
<p>Other notable limitations:</p>
<ul>
<li>Windows support is still in Preview</li>
<li>Virtual Machine Availability Sets (VMAS) are not supported for Overlay</li>
<li>Dualstack networking is not supported in Overlay</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>In conclusion, the Azure CNI Overlay provides a powerful solution to address the challenges of IP exhaustion and scalability in Azure AKS. By implementing the overlay network, organizations can overcome the limitations of the non-overlay version of Azure CNI and achieve a truly scalable and manageable infrastructure.</p>
<p>Azure CNI Overlay is currently in preview for Windows and GA for Linux nodes, but I&rsquo;m very excited about the developments. I&rsquo;ll be following them closely and I hope to be a part of its implementation at my current contract.</p>
<h1 id="links">Links:</h1>
<p><a href="https://learn.microsoft.com/en-us/azure/aks/azure-cni-overlay">https://learn.microsoft.com/en-us/azure/aks/azure-cni-overlay</a></p>
<p><a href="https://www.youtube.com/watch?v=kLBLaCC_dNs">https://www.youtube.com/watch?v=kLBLaCC_dNs</a></p>
<p><a href="https://azure.microsoft.com/en-us/updates/generally-available-azure-cni-overlay-for-linux/">https://azure.microsoft.com/en-us/updates/generally-available-azure-cni-overlay-for-linux/</a></p>
<p>202306131506</p>
<p>[[aks-networking-essentials]]</p>
]]></content:encoded>
    </item>
    
  </channel>
</rss>
