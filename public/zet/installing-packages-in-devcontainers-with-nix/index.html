<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Installing packages in Devcontainers with Nix | Mischa van den Burg</title>
<meta name=keywords content="Nix,Linux,Dev-environments"><meta name=description content="I&rsquo;ve been obsessed with Devcontainers and Devpods recently, and I&rsquo;m learning a lot about portable dev environments. This is truly the next level of config management and the future of dev environments in my opinion.
I relied on brew as my package manager, however, I ran into problems when I wanted to run my Linux dev containers on my M2 Silicon Mac. Linux brew is not supported on ARM architecture."><meta name=author content="Mischa van den Burg"><link rel=canonical href=https://mischavandenburg.com/zet/installing-packages-in-devcontainers-with-nix/><link crossorigin=anonymous href=/assets/css/stylesheet.min.e8ea20f7f0e32f55c23c7678de2e8bbd8c3aded5d82a4627a2038bf47ea08344.css integrity="sha256-6Oog9/DjL1XCPHZ43i6LvYw63tXYKkYnogOL9H6gg0Q=" rel="preload stylesheet" as=style><link rel=icon href=https://mischavandenburg.com/favicon.ico><link rel=apple-touch-icon href=https://mischavandenburg.com/apple-touch-icon.png><link rel=alternate hreflang=en href=https://mischavandenburg.com/zet/installing-packages-in-devcontainers-with-nix/><script async src="https://www.googletagmanager.com/gtag/js?id=G-VLS3GJYW82"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VLS3GJYW82")}</script><meta name=twitter:card content="summary"><meta name=twitter:title content="Installing packages in Devcontainers with Nix | Mischa van den Burg"><meta name=twitter:description content="I&rsquo;ve been obsessed with Devcontainers and Devpods recently, and I&rsquo;m learning a lot about portable dev environments. This is truly the next level of config management and the future of dev environments in my opinion.
I relied on brew as my package manager, however, I ran into problems when I wanted to run my Linux dev containers on my M2 Silicon Mac. Linux brew is not supported on ARM architecture."><meta property="og:title" content="Installing packages in Devcontainers with Nix | Mischa van den Burg"><meta property="og:description" content="I&rsquo;ve been obsessed with Devcontainers and Devpods recently, and I&rsquo;m learning a lot about portable dev environments. This is truly the next level of config management and the future of dev environments in my opinion.
I relied on brew as my package manager, however, I ran into problems when I wanted to run my Linux dev containers on my M2 Silicon Mac. Linux brew is not supported on ARM architecture."><meta property="og:type" content="article"><meta property="og:url" content="https://mischavandenburg.com/zet/installing-packages-in-devcontainers-with-nix/"><meta property="og:image" content="https://mischavandenburg.com/cloud-blue-logo.jpeg"><meta property="article:section" content="zet"><meta property="article:published_time" content="2024-05-26T00:00:00+00:00"><meta property="article:modified_time" content="2024-05-26T00:00:00+00:00"><meta property="og:site_name" content="Mischa van den Burg - Blog"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Zettelkasten","item":"https://mischavandenburg.com/zet/"},{"@type":"ListItem","position":2,"name":"Installing packages in Devcontainers with Nix","item":"https://mischavandenburg.com/zet/installing-packages-in-devcontainers-with-nix/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Installing packages in Devcontainers with Nix | Mischa van den Burg","name":"Installing packages in Devcontainers with Nix","description":"I\u0026rsquo;ve been obsessed with Devcontainers and Devpods recently, and I\u0026rsquo;m learning a lot about portable dev environments. This is truly the next level of config management and the future of dev environments in my opinion.\nI relied on brew as my package manager, however, I ran into problems when I wanted to run my Linux dev containers on my M2 Silicon Mac. Linux brew is not supported on ARM architecture.","keywords":["Nix","Linux","Dev-environments"],"wordCount":"288","inLanguage":"en","datePublished":"2024-05-26T00:00:00Z","dateModified":"2024-05-26T00:00:00Z","author":{"@type":"Person","name":"Mischa van den Burg"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://mischavandenburg.com/zet/installing-packages-in-devcontainers-with-nix/"},"publisher":{"@type":"Organization","name":"Mischa van den Burg","logo":{"@type":"ImageObject","url":"https://mischavandenburg.com/favicon.ico"}}}</script><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary-bg:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list-page{background:var(--theme)}.list-page:not(.dark)::-webkit-scrollbar-track{background:0 0}.list-page:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript></head><body class="type-zet kind-page layout-" id=top><script data-no-instant>function switchTheme(e){switch(e){case"light":document.body.classList.remove("dark");break;case"dark":document.body.classList.add("dark");break;default:window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")}}function isDarkTheme(){return document.body.className.includes("dark")}function getPrefTheme(){return localStorage.getItem("pref-theme")}function setPrefTheme(e){switchTheme(e),localStorage.setItem("pref-theme",e)}const toggleThemeCallbacks={};toggleThemeCallbacks.main=e=>{setPrefTheme(e?"light":"dark")},window.addEventListener("toggle-theme",function(){const e=isDarkTheme();for(const t in toggleThemeCallbacks)toggleThemeCallbacks[t](e)});function toggleThemeListener(){window.dispatchEvent(new CustomEvent("toggle-theme"))}</script><script>(function(){const t="auto",e=getPrefTheme(),n=e||t;switchTheme(n)})()</script><header class=header><nav class=nav><div class=logo><a href=https://mischavandenburg.com/ accesskey=h title="Mischa van den Burg (Alt + H)">Mischa van den Burg</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://mischavandenburg.com/aboutme/ title=About>About</a></li><li><a href=https://mischavandenburg.com/services/ title=Services>Services</a></li><li><a href=https://mischavandenburg.com/courses/ title=Courses>Courses</a></li><li><a href=https://mischavandenburg.com/contact/ title=Contact>Contact</a></li><li><a href=https://mischavandenburg.com/tags/ title=Tags>Tags</a></li><li><a href=https://mischavandenburg.com/archives/ title=Index>Index</a></li><li><a href=https://mischavandenburg.com/search/ title="üîç (Alt + /)" data-no-instant accesskey=/>üîç</a></li></ul></nav><a rel=me href=https://toot.community/@mischavandenburg></a></header><main class="main post"><article class=post-single><header class=post-header><h1 class=post-title>Installing packages in Devcontainers with Nix</h1><div class=post-meta><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg>
<span>May 26, 2024</span></span><span class=meta-item>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select:text"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z" style="user-select:text"/><line x1="7" y1="7" x2="7" y2="7" style="user-select:text"/></svg>
<span class=post-tags><a href=https://mischavandenburg.com/tags/nix/>Nix</a><a href=https://mischavandenburg.com/tags/linux/>Linux</a><a href=https://mischavandenburg.com/tags/dev-environments/>Dev-Environments</a></span></span></div></header><div class=post-content><p>I&rsquo;ve been obsessed with Devcontainers and Devpods recently, and I&rsquo;m learning a lot about portable dev environments. This is truly the next level of config management and the future of dev environments in my opinion.</p><p>I relied on brew as my package manager, however, I ran into problems when I wanted to run my Linux dev containers on my M2 Silicon Mac. Linux brew is not supported on ARM architecture.</p><h1 id=use-case>Use case<a hidden class=anchor aria-hidden=true href=#use-case>¬∂</a></h1><p>I all I need to do is install a list of packages into a linux container. I was using brew because I need to install packages like k9s and flux which are sometimes not available in the standard package repositories.</p><p>After some tinkering with Nix I managed to solve my problem.</p><h1 id=nixpkgs>Nixpkgs<a hidden class=anchor aria-hidden=true href=#nixpkgs>¬∂</a></h1><p>My dotfiles contains this setup script:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>    <span class=nb>export</span> <span class=nv>XDG_CONFIG_HOME</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$HOME</span><span class=s2>&#34;</span>/.config
</span></span><span class=line><span class=cl>    mkdir -p <span class=s2>&#34;</span><span class=nv>$XDG_CONFIG_HOME</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    mkdir -p <span class=s2>&#34;</span><span class=nv>$XDG_CONFIG_HOME</span><span class=s2>&#34;</span>/nixpkgs
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    ln -sf <span class=s2>&#34;</span><span class=nv>$PWD</span><span class=s2>/nvim&#34;</span> <span class=s2>&#34;</span><span class=nv>$XDG_CONFIG_HOME</span><span class=s2>&#34;</span>/nvim
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    ln -sf <span class=s2>&#34;</span><span class=nv>$PWD</span><span class=s2>/.bash_profile&#34;</span> <span class=s2>&#34;</span><span class=nv>$HOME</span><span class=s2>&#34;</span>/.bash_profile
</span></span><span class=line><span class=cl>    ln -sf <span class=s2>&#34;</span><span class=nv>$PWD</span><span class=s2>/.bashrc&#34;</span> <span class=s2>&#34;</span><span class=nv>$HOME</span><span class=s2>&#34;</span>/.bashrc
</span></span><span class=line><span class=cl>    ln -sf <span class=s2>&#34;</span><span class=nv>$PWD</span><span class=s2>/.inputrc&#34;</span> <span class=s2>&#34;</span><span class=nv>$HOME</span><span class=s2>&#34;</span>/.inputrc
</span></span><span class=line><span class=cl>    ln -sf <span class=s2>&#34;</span><span class=nv>$PWD</span><span class=s2>/.tmux.conf&#34;</span> <span class=s2>&#34;</span><span class=nv>$HOME</span><span class=s2>&#34;</span>/.tmux.conf
</span></span><span class=line><span class=cl>    ln -sf <span class=s2>&#34;</span><span class=nv>$PWD</span><span class=s2>/config.nix&#34;</span> <span class=s2>&#34;</span><span class=nv>$XDG_CONFIG_HOME</span><span class=s2>&#34;</span>/nixpkgs/config.nix
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># install Nix packages from config.nix</span>
</span></span><span class=line><span class=cl>    nix-env -iA nixpkgs.myPackages
</span></span></code></pre></div><p>It sets up the nixpkgs directory and the config.nix.</p><p>The config.nix contains the packages I want to install:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>packageOverrides</span> <span class=o>=</span> <span class=n>pkgs</span><span class=p>:</span> <span class=k>with</span> <span class=n>pkgs</span><span class=p>;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>myPackages</span> <span class=o>=</span> <span class=n>pkgs</span><span class=o>.</span><span class=n>buildEnv</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>name</span> <span class=o>=</span> <span class=s2>&#34;mischa-tools&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>paths</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=n>neovim</span>
</span></span><span class=line><span class=cl>        <span class=n>go</span>
</span></span><span class=line><span class=cl>        <span class=n>nodejs_22</span>
</span></span><span class=line><span class=cl>        <span class=n>starship</span>
</span></span><span class=line><span class=cl>        <span class=n>fd</span>
</span></span><span class=line><span class=cl>        <span class=n>ripgrep</span>
</span></span><span class=line><span class=cl>        <span class=n>lazygit</span>
</span></span><span class=line><span class=cl>        <span class=n>kubectl</span>
</span></span><span class=line><span class=cl>        <span class=n>k9s</span>
</span></span><span class=line><span class=cl>        <span class=n>fluxcd</span>
</span></span><span class=line><span class=cl>      <span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Finally, the <code>nix-env -iA nixpkgs.myPackages</code> command installs all of the packages into my environment.</p><p>I was lucky to find this in the Nix documentation:</p><p><a href=https://nixos.org/manual/nixpkgs/stable/#sec-declarative-package-management>https://nixos.org/manual/nixpkgs/stable/#sec-declarative-package-management</a></p><p>Had I not found this particular heading, I think I would have been lost in the weeds for a long time. But Nix has definitely piqued my interest and I look forward to learn more about it.</p><h2 id=links>Links:<a hidden class=anchor aria-hidden=true href=#links>¬∂</a></h2><p>Devpod dotfiles: <a href=https://github.com/mischavandenburg/dotfiles-devpod>https://github.com/mischavandenburg/dotfiles-devpod</a></p><p>202405261105</p></div><footer class=post-footer><nav class=paginav><a class=prev href=https://mischavandenburg.com/zet/got-my-cks/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></svg>&nbsp;Prev Page</span><br><span>Got my CKS</span>
</a><a class=next href=https://mischavandenburg.com/zet/best-way-to-download-youtube-videos-from-cli/><span class=title>Next Page&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span><br><span>Best Way To Download Youtube Videos From Cli</span></a></nav></footer><div class=comments-separator></div></article></main><footer class=footer><span>&copy; 2024 <a href=https://mischavandenburg.com/>Mischa van den Burg</a></span><span style=display:inline-block;margin-left:1em>
<a href=https://creativecommons.org/licenses/by-nc-nd/4.0/>CC BY-NC-ND</a>
</span><span style=display:inline-block;margin-left:1em><a href=https://mischavandenburg.com/skool>My Community -</a>
<a href=https://twitter.com/mischa_vdburg>Twitter</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>(function(){const t=""=="1";if(t)return;let e=document.getElementById("theme-toggle");e.removeEventListener("click",toggleThemeListener),e.addEventListener("click",toggleThemeListener)})()</script><script>(function(){let e=document.getElementById("menu");e&&(e.scrollLeft=localStorage.getItem("menu-scroll-position"),e.onscroll=function(){localStorage.setItem("menu-scroll-position",e.scrollLeft)});const t=""=="1",n=""=="1";if(window.matchMedia("(prefers-reduced-motion: reduce)").matches||t||n)return;document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})})()</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>if(window.scrollListeners)for(const e of scrollListeners)window.removeEventListener("scroll",e);window.scrollListeners=[]</script><script src=/js/medium-zoom.min.js data-no-instant></script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script>(function(){const a=""=="1";if(!a)return;if(!document.querySelector(".toc")){console.log("no toc found, ignore toc scroll");return}const r=window.scrollListeners,t=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id]"),n="active";let e=t[0];o(e).classList.add(n);const c=()=>{const s=[];for(const e of t)if(l(e)<5)s.push(e);else break;s.length>0?newActiveHeading=s[s.length-1]:newActiveHeading=t[0],e!=newActiveHeading&&(o(e).classList.remove(n),e=newActiveHeading,o(e).classList.add(n))};let s=null;const i=()=>{s!==null&&clearTimeout(s),s=setTimeout(c,50)};window.addEventListener("scroll",i,!1),r.push(i);function o(e){const t=encodeURI(e.getAttribute("id")).toLowerCase();return document.querySelector(`.toc ul li a[href="#${t}"]`)}function l(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect();return t.top}})()</script></body></html>