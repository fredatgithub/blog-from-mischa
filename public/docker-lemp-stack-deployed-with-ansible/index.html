<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Docker LEMP Stack deployed with Ansible | Mischa van den Burg</title>
<meta name=keywords content="DevOps"><meta name=description content="In order to learn more about Docker and Ansible I am working on an assignment to take an existing application and to break it down into containers. However, in order to be able to understand this process properly, I first needed to understand more about Docker and containerisation.
I wrote a playbook that installs Docker and deploys a fully containerised LEMP stack on a virtual machine.
You can have a look at the Github repo with the result here."><meta name=author content="Mischa van den Burg"><link rel=canonical href=https://mischavandenburg.com/docker-lemp-stack-deployed-with-ansible/><link crossorigin=anonymous href=/assets/css/stylesheet.min.e8ea20f7f0e32f55c23c7678de2e8bbd8c3aded5d82a4627a2038bf47ea08344.css integrity="sha256-6Oog9/DjL1XCPHZ43i6LvYw63tXYKkYnogOL9H6gg0Q=" rel="preload stylesheet" as=style><link rel=icon href=https://mischavandenburg.com/favicon.ico><link rel=apple-touch-icon href=https://mischavandenburg.com/apple-touch-icon.png><link rel=alternate hreflang=en href=https://mischavandenburg.com/docker-lemp-stack-deployed-with-ansible/><script async src="https://www.googletagmanager.com/gtag/js?id=G-VLS3GJYW82"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VLS3GJYW82")}</script><meta name=twitter:card content="summary"><meta name=twitter:title content="Docker LEMP Stack deployed with Ansible | Mischa van den Burg"><meta name=twitter:description content="In order to learn more about Docker and Ansible I am working on an assignment to take an existing application and to break it down into containers. However, in order to be able to understand this process properly, I first needed to understand more about Docker and containerisation.
I wrote a playbook that installs Docker and deploys a fully containerised LEMP stack on a virtual machine.
You can have a look at the Github repo with the result here."><meta property="og:title" content="Docker LEMP Stack deployed with Ansible | Mischa van den Burg"><meta property="og:description" content="In order to learn more about Docker and Ansible I am working on an assignment to take an existing application and to break it down into containers. However, in order to be able to understand this process properly, I first needed to understand more about Docker and containerisation.
I wrote a playbook that installs Docker and deploys a fully containerised LEMP stack on a virtual machine.
You can have a look at the Github repo with the result here."><meta property="og:type" content="article"><meta property="og:url" content="https://mischavandenburg.com/docker-lemp-stack-deployed-with-ansible/"><meta property="og:image" content="https://mischavandenburg.com/cloud-blue-logo.jpeg"><meta property="article:section" content="zet"><meta property="article:published_time" content="2022-01-30T16:20:24+00:00"><meta property="article:modified_time" content="2022-01-30T16:20:24+00:00"><meta property="og:site_name" content="Mischa van den Burg - Blog"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Zettelkasten","item":"https://mischavandenburg.com/zet/"},{"@type":"ListItem","position":2,"name":"All Articles","item":"https://mischavandenburg.com/zet/articles/"},{"@type":"ListItem","position":3,"name":"Docker LEMP Stack deployed with Ansible","item":"https://mischavandenburg.com/docker-lemp-stack-deployed-with-ansible/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Docker LEMP Stack deployed with Ansible | Mischa van den Burg","name":"Docker LEMP Stack deployed with Ansible","description":"In order to learn more about Docker and Ansible I am working on an assignment to take an existing application and to break it down into containers. However, in order to be able to understand this process properly, I first needed to understand more about Docker and containerisation.\nI wrote a playbook that installs Docker and deploys a fully containerised LEMP stack on a virtual machine.\nYou can have a look at the Github repo with the result here.","keywords":["DevOps"],"wordCount":"1182","inLanguage":"en","datePublished":"2022-01-30T16:20:24Z","dateModified":"2022-01-30T16:20:24Z","author":{"@type":"Person","name":"Mischa van den Burg"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://mischavandenburg.com/docker-lemp-stack-deployed-with-ansible/"},"publisher":{"@type":"Organization","name":"Mischa van den Burg","logo":{"@type":"ImageObject","url":"https://mischavandenburg.com/favicon.ico"}}}</script><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary-bg:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list-page{background:var(--theme)}.list-page:not(.dark)::-webkit-scrollbar-track{background:0 0}.list-page:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript></head><body class="type-zet kind-page layout-" id=top><script data-no-instant>function switchTheme(e){switch(e){case"light":document.body.classList.remove("dark");break;case"dark":document.body.classList.add("dark");break;default:window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")}}function isDarkTheme(){return document.body.className.includes("dark")}function getPrefTheme(){return localStorage.getItem("pref-theme")}function setPrefTheme(e){switchTheme(e),localStorage.setItem("pref-theme",e)}const toggleThemeCallbacks={};toggleThemeCallbacks.main=e=>{setPrefTheme(e?"light":"dark")},window.addEventListener("toggle-theme",function(){const e=isDarkTheme();for(const t in toggleThemeCallbacks)toggleThemeCallbacks[t](e)});function toggleThemeListener(){window.dispatchEvent(new CustomEvent("toggle-theme"))}</script><script>(function(){const t="auto",e=getPrefTheme(),n=e||t;switchTheme(n)})()</script><header class=header><nav class=nav><div class=logo><a href=https://mischavandenburg.com/ accesskey=h title="Mischa van den Burg (Alt + H)">Mischa van den Burg</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://mischavandenburg.com/aboutme/ title=About>About</a></li><li><a href=https://mischavandenburg.com/services/ title=Services>Services</a></li><li><a href=https://mischavandenburg.com/coaching/ title=Coaching>Coaching</a></li><li><a href=https://mischavandenburg.com/courses/ title=Courses>Courses</a></li><li><a href=https://mischavandenburg.com/contact/ title=Contact>Contact</a></li><li><a href=https://mischavandenburg.com/tags/ title=Tags>Tags</a></li><li><a href=https://mischavandenburg.com/archives/ title=Index>Index</a></li><li><a href=https://mischavandenburg.com/search/ title="üîç (Alt + /)" data-no-instant accesskey=/>üîç</a></li></ul></nav><a rel=me href=https://toot.community/@mischavandenburg></a></header><main class="main post"><article class=post-single><header class=post-header><h1 class=post-title>Docker LEMP Stack deployed with Ansible</h1><div class=post-meta><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg>
<span>January 30, 2022</span></span><span class=meta-item>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select:text"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z" style="user-select:text"/><line x1="7" y1="7" x2="7" y2="7" style="user-select:text"/></svg>
<span class=post-tags><a href=https://mischavandenburg.com/tags/devops/>DevOps</a></span></span></div></header><div class=post-content><p>In order to learn more about Docker and Ansible I am working on an assignment to take an existing application and to break it down into containers. However, in order to be able to understand this process properly, I first needed to understand more about Docker and containerisation.</p><p>I wrote a playbook that installs Docker and deploys a fully containerised LEMP stack on a virtual machine.</p><p><a href=https://github.com/mischavandenburg/lemp_docker_ansible>You can have a look at the Github repo with the result here.</a></p><p>The repo is using the ‚Äúansible-galaxy init‚Äù role structure. You will find the playbooks as follows: roles/your_choice/tasks/main.yml</p><h2 id=docker>Docker<a hidden class=anchor aria-hidden=true href=#docker>¬∂</a></h2><p>I was very excited to learn more about Docker and containerisation. I was familiar with the concept of virtualisation, which is creating virtual versions of fully functional machines on a host operating system. But the concept of containerisation was new to me.</p><p>As I understand it, containerisation differs drastically from virtualisation because containers are able to use resources from host directly. They do not need an entire operating system to run, and therefore they are a much more lightweight.</p><p>This means that resources can be used much more efficiently which eventually can mean cost reduction in your cloud infrastructure.</p><p>Docker is a very popular platform for building and running containers. It seemed like the best option to get started with deploying my own containers.</p><h2 id=lemp-stack>LEMP Stack<a hidden class=anchor aria-hidden=true href=#lemp-stack>¬∂</a></h2><p>My colleague recommended me <a href=https://tech.osteel.me/posts/docker-for-local-web-development-part-1-a-basic-lemp-stack>this tutorial</a> to become more familiar with Docker. It uses a LEMP stack as an example application. When I told friends about the fact that I was building a LEMP stack, they corrected me and said it was a LAMP stack.</p><p>The LAMP stack is a collection of software built out of these elements:</p><p>L ‚Äì Linux: the operating system</p><p>A ‚Äì Apace: webserver</p><p>M ‚Äì MySQL: database</p><p>P ‚Äì PHP: server scripting language</p><p>However, in a LEMP stack, we use NGINX as a webserver, which is pronounced ‚ÄúEngine X‚Äù, hence the E in LEMP stack. Therefore, LEMP is the correct way to spell it, and it is used in all the tutorials that I have been using.</p><p>I highly recommend <a href=https://tech.osteel.me/posts/docker-for-local-web-development-part-1-a-basic-lemp-stack>the tutorial</a> in order to learn how to deploy your first collection of containers. Deploying one container is relatively easy with Docker, but it gets a little more complicated when deploying several containers and making them communicate with each other in order to combine them into one application. But this tutorial does a great job at showing you how it‚Äôs done and it is especially good at explaining the steps along the way.</p><h2 id=docker-compose-vs-ansible>Docker Compose vs. Ansible<a hidden class=anchor aria-hidden=true href=#docker-compose-vs-ansible>¬∂</a></h2><p>Docker Compose is a tool you can use to run multi-container applications. With the help of the tutorial, it was fairly easy to understand and hit the ground running by deploying multiple containers into one network.</p><p>Now let‚Äôs have a look at how we actually set up the containers. In the Docker Compose file, the NGINX container was defined like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.8&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#Services</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#Nginx Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nginx</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:1.19</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>80</span><span class=p>:</span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./src:/var/www/php</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./.docker/nginx/conf.d:/etc/nginx/conf.d</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>php</span><span class=w>
</span></span></span></code></pre></div><p>It looks pretty straightforward, right? Almost like pseudocode. We tell Docker which image to pull from the Docker Hub, and we tell it to route container‚Äôs port 80 to our host‚Äôs port 80. This ensures that the web server can be accessed from the outside, provided you have opened this port in the firewall.</p><p>Next there is the volumes section: this mounts certain directories on the host into the container so it is accessible. In this case this was necessary to transfer the web server configuration and the index.php which we wanted to serve to the outside.</p><p>Having successfully deployed my LEMP using Docker Compose, the next step was to automate this process by using Ansible. Ansible is a very powerful tool which enables you to automate configuration management and application deployment by writing scripts called playbooks.</p><h5 id=why-was-it-necessary-to-introduce-ansible>Why was it necessary to introduce Ansible?<a hidden class=anchor aria-hidden=true href=#why-was-it-necessary-to-introduce-ansible>¬∂</a></h5><p>By using Docker Compose, you would need to have Docker and Docker Compose installed on the virtual machine before you could start running the containers.</p><p>However, Ansible gives you the power to take a completely fresh virtual machine, configure it from scratch, and install Docker and its necessary dependencies, followed by deploying the containers.</p><h4 id=now-lets-take-a-look-at-the-same-container-defined-in-ansible>Now let‚Äôs take a look at the same container defined in Ansible:<a hidden class=anchor aria-hidden=true href=#now-lets-take-a-look-at-the-same-container-defined-in-ansible>¬∂</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>start nginx </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>docker_container</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:1.19</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detach</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>80</span><span class=p>:</span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>network_one</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/src:/var/www/php</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/.docker/nginx/conf.d:/etc/nginx/conf.d</span><span class=w>
</span></span></span></code></pre></div><p>Although there are some differences, they look very similar. Converting my Docker Compose file to an Ansible playbook was quite a natural and easy experience. It also helps that both are written in YAML and therefore use the same indentation conventions.</p><p>A few differences we can observe:</p><p>In the Ansible playbook we invoke the docker_container module, whereas they are defined as services in the Docker Compose file. Another difference is that we need to set up the network ourselves. In the Docker Compose file, we just specified the containers and Docker Compose created a network automatically and made sure that all containers were connected to it.</p><p>However, it isn‚Äôt very complicated in Ansible either:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>setup network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>docker_network</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>network_one</span><span class=w>
</span></span></span></code></pre></div><p>We simply call the docker_network module and tell it to make a network called network_one. All we need to do then is make sure to set the networks: parameter to network_one in the docker_container module as we saw above.</p><p>The last point to note is the detach parameter. This means that the container will keep running in the background after it is started.</p><h3 id=result>Result<a hidden class=anchor aria-hidden=true href=#result>¬∂</a></h3><p>After some debugging here and there and making sure all of the elements were in place, eventually we get the satisfying message that everything went according to plan:</p><p><img loading=lazy src=/success.png type alt="Successful play from Ansible"></p><p>The result is a webpage being served on the server ip:</p><p><img loading=lazy src=/webpage.png type alt="The final web page served by Nginx "></p><p>I know, it is not the prettiest or most intricate design. But remember that I am working towards becoming a DevOps Engineer, not a Front End Developer üòâ</p><p>We can also enter the phpMyAdmin dashboard by adding port 8080 to our ip in the browser:</p><p><img loading=lazy src=/php.png type alt="The PHP page."></p><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>¬∂</a></h2><p>The assignment of deploying a LEMP stack in separate containers has been very useful and I learned a lot from the process. There were a few more modules that needed to be configured in Ansible as opposed to the Docker Compose method, but the tradeoff is that Ansible is much more powerful and enables you to configure the server from scratch. You can have a look at the code in the GitHub repo to see all of the changes I needed to do.</p><p>The only part that I needed to do by hand is to create the VM in the Microsoft Azure portal, open the ports and configure the SSH keys. The next step in my learning process will be to learn how I can automate this step as well. This means that I will need to learn Terraform.</p><p>By using Terraform I will be truly deploying this stack as Infrastructure as Code, but doing all of these steps with Ansible has given me a much better understanding of Infrastructure as Code already.</p></div><footer class=post-footer><nav class=paginav><a class=prev href=https://mischavandenburg.com/python-project-mad-libs/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></svg>&nbsp;Prev Page</span><br><span>Python Project: Mad Libs</span>
</a><a class=next href=https://mischavandenburg.com/why-i-chose-a-bear-for-my-logo/><span class=title>Next Page&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span><br><span>Why I Chose a Bear as a Logo</span></a></nav></footer><div class=comments-separator></div></article></main><footer class=footer><span>&copy; 2024 <a href=https://mischavandenburg.com/>Mischa van den Burg</a></span><span style=display:inline-block;margin-left:1em>
<a href=https://creativecommons.org/licenses/by-nc-nd/4.0/>CC BY-NC-ND</a>
</span><span style=display:inline-block;margin-left:1em><a href=https://mischavandenburg.com/skool>My Community -</a>
<a href=https://twitter.com/mischa_vdburg>Twitter</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>(function(){const t=""=="1";if(t)return;let e=document.getElementById("theme-toggle");e.removeEventListener("click",toggleThemeListener),e.addEventListener("click",toggleThemeListener)})()</script><script>(function(){let e=document.getElementById("menu");e&&(e.scrollLeft=localStorage.getItem("menu-scroll-position"),e.onscroll=function(){localStorage.setItem("menu-scroll-position",e.scrollLeft)});const t=""=="1",n=""=="1";if(window.matchMedia("(prefers-reduced-motion: reduce)").matches||t||n)return;document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})})()</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>if(window.scrollListeners)for(const e of scrollListeners)window.removeEventListener("scroll",e);window.scrollListeners=[]</script><script src=/js/medium-zoom.min.js data-no-instant></script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script>(function(){const a=""=="1";if(!a)return;if(!document.querySelector(".toc")){console.log("no toc found, ignore toc scroll");return}const r=window.scrollListeners,t=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id]"),n="active";let e=t[0];o(e).classList.add(n);const c=()=>{const s=[];for(const e of t)if(l(e)<5)s.push(e);else break;s.length>0?newActiveHeading=s[s.length-1]:newActiveHeading=t[0],e!=newActiveHeading&&(o(e).classList.remove(n),e=newActiveHeading,o(e).classList.add(n))};let s=null;const i=()=>{s!==null&&clearTimeout(s),s=setTimeout(c,50)};window.addEventListener("scroll",i,!1),r.push(i);function o(e){const t=encodeURI(e.getAttribute("id")).toLowerCase();return document.querySelector(`.toc ul li a[href="#${t}"]`)}function l(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect();return t.top}})()</script></body></html>